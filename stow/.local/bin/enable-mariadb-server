#!/usr/bin/env bash

# Install and configure the MySQL database.

set -e

sudo pacman -Sy --noconfirm --needed mariadb

# Disable btrfs copy-on-write for database directory.
fstype=$(mount | grep " /var " | cut -d' ' -f5)
test "$fstype" = btrfs && sudo chattr +C /var/lib/mysql

sudo mysql_install_db --user=mysql --basedir=/usr --datadir=/var/lib/mysql

sudo systemctl enable --now mariadb.service

sudo mysql_secure_installation
mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql -u root -p mysql
