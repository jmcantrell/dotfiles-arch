#!/usr/bin/env bash

# Install and configure the MySQL database.

set -eu

sudo pacman --sync --noconfirm --needed mariadb

data_dir=/var/lib/mysql

# Disable copy-on-write if on a btrfs file system.
if [[ $(stat -f -c %T "$data_dir") == btrfs ]]; then
    sudo chattr +C "$data_dir"
fi

sudo mysql_install_db --user=mysql --basedir=/usr --datadir="$data_dir"

sudo systemctl enable --now mariadb.service

sudo mysql_secure_installation
mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql -u root -p mysql
