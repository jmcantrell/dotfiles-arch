#!/usr/bin/env bash

# Install and configure the MySQL database.

set -eu

sudo pacman --sync --noconfirm --needed mariadb

mysql=/var/lib/mysql

# Disable copy-on-write if on a btrfs file system.
if [[ $(stat -f -c %T "$mysql") == btrfs ]]; then
    sudo chattr +C "$mysql"
fi

sudo mysql_install_db --user=mysql --basedir=/usr --datadir="$mysql"

sudo systemctl enable --now mariadb.service

sudo mysql_secure_installation
mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql -u root -p mysql
