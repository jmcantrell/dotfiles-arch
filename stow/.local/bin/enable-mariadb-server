#!/usr/bin/env bash

# Install and configure the MySQL database.

set -euo pipefail

sudo pacman -S --noconfirm --needed mariadb

mysql=/var/lib/mysql

# Disable copy-on-write if on a btrfs file system.
[[ $(stat -f -c %T "$mysql") == btrfs ]] && sudo chattr +C "$mysql"

sudo mysql_install_db --user=mysql --basedir=/usr --datadir="$mysql"

sudo systemctl enable --now mariadb.service

sudo mysql_secure_installation
mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql -u root -p mysql
