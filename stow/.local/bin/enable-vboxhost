#!/usr/bin/env sh

# Install and configure localhost as a virtualbox host.

has xinit || exit 0

sudo pacman -S --noconfirm --needed \
    virtualbox virtualbox-host-modules-arch

pacaur -y --noconfirm --needed --noedit \
    virtualbox-ext-oracle

sudo gpasswd -a "$USER" vboxusers

vmsdir="$HOME/VirtualBox VMs"

mkdir -p "$vmsdir"

# disable btrfs copy-on-write for vms folder
fstype=`mount | grep " `dirname "$HOME"` " | cut -d' ' -f5`
test "$fstype" = btrfs && chattr +C "$vmsdir"
