#!/usr/bin/env bash

# Install and configure VirtualBox to be used as a virtual machine host.

set -euo pipefail

sudo pacman -Sy --noconfirm --needed virtualbox virtualbox-host-modules-arch
pikaur -Sy --noconfirm --needed virtualbox-ext-oracle
sudo gpasswd -a "$USER" vboxusers

vms_dir=${XDG_DATA_HOME:-$HOME/.local/share}/virtualbox
mkdir -p "$vms_dir"

vboxmanage setproperty machinefolder "$vms_dir"

# Disable copy-on-write if on a btrfs file system.
[[ $(stat -f -c %T "$vms_dir") == btrfs ]] && chattr +C "$vms_dir"
