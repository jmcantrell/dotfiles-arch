#!/usr/bin/env bash

# Simple AUR installer intended as a fallback.

set -e

temp=$(mktemp -d -t aur-install.XXXXXXXXXX)
trap "rm -rf $(printf "%q" "$temp")" INT TERM EXIT

url="https://aur.archlinux.org/cgit/aur.git/snapshot"

for name in "$@"; do
    # Skip packages that are already installed.
    pacman -Qq "$name" &>/dev/null || continue

    cd "$temp"

    package=$name.tar.gz
    curl -L -o "$package" "$url/$package"
    tar -x -f "$package"

    cd "$temp/$name"

    makepkg -fsri --noconfirm --needed
done
