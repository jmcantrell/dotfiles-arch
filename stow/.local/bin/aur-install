#!/usr/bin/env bash

# Simple AUR package builder and installer.

set -euo pipefail

me=${0##*/}
temp_dir=$(mktemp -d -t "$me".XXXXXXXXXX)
trap 'rm -rf "$temp_dir"' INT TERM EXIT

url="https://aur.archlinux.org/cgit/aur.git/snapshot"

for name in "$@"; do
    # Don't build package if it's already installed.
    if pacman -Qq | grep -q "^$name$"; then
        continue
    fi

    cd "$temp_dir"

    package=$name.tar.gz
    curl -L -o "$package" "$url/$package"
    tar -x -f "$package"

    cd "$temp_dir/$name"

    makepkg -fsri --noconfirm
done
