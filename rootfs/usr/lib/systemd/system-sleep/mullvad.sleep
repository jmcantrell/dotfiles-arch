#!/usr/bin/env sh

STATE_FILE=$0.state

clear_state() {
    rm -f "$STATE_FILE"
}

save_state() {
    clear_state
    if test -e /proc/sys/net/ipv4/conf/wg-mullvad; then
        touch "$STATE_FILE"
        mullvad disconnect
    fi
}

restore_state() {
    test -f "$STATE_FILE" && mullvad connect
}

when=$1  # will be: "pre" or "post"
# what=$2  # will be: "suspend", "hibernate", "hybrid-sleep", or "suspend-then-hibernate"

case $when in
    pre) save_state ;;
    post) restore_state ;;
esac
